angular.module("HomepageApp",["ngMaterial","ngCookies","homepageModule","NavbarApp"]).controller("HomepageController",["$scope","$http","homepageHttpMethods","$rootScope","$q",async function(e,o,t,r,s){e.projects=[],e.userInfo={};const i=t.getUserInfo().then((e=>(console.log("getUserInfo"),e.data))),n=t.getFirstProjects().then((e=>(console.log("getProjects"),e.data.firstProjects)));e.changeClass=e=>{e.isLiked=!e.isLiked},e.sortIsLiked=()=>{e.projects.forEach((o=>{o.isLiked=!!e.userInfo.likedProjects[o._id]}))},e.sortIsSupported=()=>{e.projects.forEach((o=>{console.log(o.title," is ",e.userInfo.supportedProjects[o._id]),o.isSupported=!!e.userInfo.supportedProjects[o._id]}))},e.sortProgress=()=>{e.projects.forEach((e=>{e.percentage=Math.round(e.amountAlreadyRaised/e.amountToRaise*100),console.log(e.percentage),e.progressBarStyle={width:`${e.percentage}%`}}))},e.initInfo=()=>{s.all([i,n]).then((o=>{const[t,r]=o;console.log(o);const s=r.map((e=>{const o={...e};return o.isLiked=((e,o)=>e.likedProjects[o._id])(t,o),o.isSupported=((e,o)=>e.likedProjects[o._id])(t,o),o.percentage=(e=>Math.round(e.amountAlreadyRaised/e.amountToRaise*100))(o),o.progressBarStyle=(e=>({width:`${e.percentage}%`}))(o),o}));e.projects=s,console.log(e.projects)}))},e.moveToProfile=e=>{console.log(e),window.location.href=`/userProfile?creatorUserID=${e}`},e.moveToProject=e=>{console.log(e),window.localStorage.setItem("currentViewedProject",JSON.stringify(e)),window.location.href=`/viewProject?_id=${e._id}`},e.likeProject=o=>{console.log("liking project: ",o._id),t.addLikeToProject(o._id,o.isLiked).then((t=>{console.log(t.data),o.isLiked=!o.isLiked,e.userInfo.likedProjects[o._id]=!e.userInfo.likedProjects[o._id],window.localStorage.setItem("UserInfo",JSON.stringify(e.userInfo));const r=JSON.parse(window.localStorage.getItem("UserInfo"));console.log(r)}))}}]);