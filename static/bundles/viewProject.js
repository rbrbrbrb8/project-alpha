(()=>{const e=angular.module("ViewProjectApp",["ngMaterial","ngCookies","viewProjectModule"]);e.controller("viewProjectController",["$scope","$timeout","$mdDialog","viewProjectHttpMethods","projectDetails",function(e,o,t,n,r){e.clearCurrentViewedProjectProperty=()=>{window.localStorage.removeItem("currentViewedProject")};const c=window.localStorage.getItem("currentViewedProject"),l=window.location.search;c?e.currentViewedProject=JSON.parse(window.localStorage.getItem("currentViewedProject")):(e.currentViewedProject={},n.requestCurrentViewedProjectInfo(l).then((o=>{const t=o.data;t&&(e.currentViewedProject=t)}))),console.log(window.location.search),e.clearCurrentViewedProjectProperty(),e.donate=(o,n)=>{r.currentReward=o,console.log("opening donation modal"),t.show({controller:"DialogController",templateUrl:"/views/donateDialog.html",locals:{projectId:e.currentViewedProject._id,currentReward:o},parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,fullscreen:e.customFullscreen}).then((function(e){console.log("finished donating")}),(function(){console.log("You cancelled the dialog."),console.log(e),e.status="You cancelled the dialog."}))}}]),e.factory("projectDetails",["viewProjectHttpMethods",function(e){const o={},t=window.localStorage.getItem("currentViewedProject"),n=window.location.search;return t?o.currentViewedProject=JSON.parse(window.localStorage.getItem("currentViewedProject")):(o.currentViewedProject={},e.requestCurrentViewedProjectInfo(n).then((e=>{const t=e.data;t&&(o.currentViewedProject=t)}))),o}]),e.controller("DialogController",["$scope","$mdDialog","projectDetails","viewProjectHttpMethods","$timeout",function(e,o,t,n,r,c,l){e.isModalConfirmed=!1,e.afterSec=!1,e.cancelTransaction=()=>{console.log(c),console.log(l),o.cancel()},e.closeModal=()=>{},e.changeAnim=()=>{e.afterSec=!0,console.log("switching message"),e.transactionMessage="Transaction Complete!",console.log(e.afterSec)},e.submitTransaction=()=>{const c=(o=>{if(console.log(e.paymentDetails),!o)return!1;const t=Object.entries(o);console.log(t);const n=new RegExp("^([w]{3,})+s+([ws]{3,})+$","i"),r=new RegExp("^[0-9]{16}$"),c=new RegExp("^[d]{2}/[d]{4}"),l=new RegExp("^[0-9]{3}$");let a=!0;return t.length<4?(alert("need to fill the entire form"),!1):(t.forEach(((e,o)=>{e[1]||(console.log("wrong"),a=!1)})),!(!a||(n.test(o.cardholderName)?(console.log("failed name"),1):r.test(o.cardNumber)?c.test(o.cardExpiryDate)?(console.log("failed exp"),1):!l.test(o.cardCVV)&&(console.log("failed CVV"),1):(console.log("failed number"),1))))})(e.paymentDetails);console.log(c),console.log("project details"),console.log(t),c&&(e.transactionMessage="Sending Transaction",e.isModalConfirmed=!0,e.isRequestCompleted=!1,n.addDonationToProject(t.currentViewedProject._id,t.currentReward.donationAmount).then((async t=>{e.isRequestCompleted=!0,await r(e.changeAnim,930),console.log("hiding dialog"),r(o.hide,1e3)})))}}]),e.directive("navbar",[function(){return{restrict:"E",scope:{},controller:function(e){},templateUrl:"../views/navbar.html"}}])})();